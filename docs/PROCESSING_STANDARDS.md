# 讲道处理标准 / Sermon Processing Standards

本文档记录了经过验证的讲道内容处理标准，确保 100% 内容完整性。

---

## 1️⃣ 内容完整性标准（最高优先级）

### ✅ 必须遵守
- **100% 内容保留** - 绝不总结、省略或缩减任何内容
- **验证机制** - 处理后长度变化必须在 ±2% 以内
- **只允许格式变化** - 长度差异仅能来自空格、换行等格式变化

### ❌ 严格禁止
- **禁止使用 LLM 自动聚合段落** - 已验证会导致 68% 内容丢失
- **禁止任何形式的总结或改写** - 必须忠于原文
- **禁止猜测或补充内容** - 只处理现有内容

### 🔍 验证方法
```python
# 使用 safe_paragraph_merger.py 进行验证
diff_percent = abs(new_length - original_length) / original_length * 100
if diff_percent > 2:
    # 失败：内容可能被更改
    raise ValidationError("Content length changed by more than 2%")
```

---

## 2️⃣ 段落格式标准

### ✅ 中文段落
- **每段句子数**: 4 句话（推荐）
- **分句依据**: 按 `。！？` 中文标点分句
- **段落间距**: 双换行符 `\n\n` 分隔

### ✅ 英文段落
- **每段句子数**: 4 句话（推荐）
- **分句依据**: 按 `.!?` 英文标点分句
- **段落间距**: 双换行符 `\n\n` 分隔

### 🛠️ 使用工具
```bash
# 安全段落合并器（已验证，可批量使用）
python3 scripts/safe_paragraph_merger.py --file "Sermon_Name"

# 只处理中文
python3 scripts/safe_paragraph_merger.py --file "Sermon_Name" --chinese-only

# 只处理英文
python3 scripts/safe_paragraph_merger.py --file "Sermon_Name" --english-only
```

---

## 3️⃣ 小标题标准（可选，质量优先）

### ✅ 何时添加小标题
- **重要讲道** - 用户指定的核心讲道
- **结构复杂的讲道** - 多个要点、层次深的讲道
- **已完成翻译的讲道** - 优先处理完整内容

### ✅ 小标题层级
```markdown
### 一级小标题（主要部分）
引言、经文阅读、讲道框架、要点一、要点二、结论、祷告

#### 二级小标题（子部分）
迹象一、迹象二、应用一、应用二
```

### ✅ 命名规范
- **描述性** - 如 "要点一：人类的终极困境"
- **简洁明了** - 不超过 15 个字符（中文）或 50 个字符（英文）
- **忠于讲道** - 直接反映讲道内容，不添加解释

### 🛠️ 方法
- **手动添加** - 确保质量和准确性（已在 A_New_Heart 上验证）
- **逐个处理** - 不批量自动化（避免内容损失）

### 📊 验证标准
- **内容完整性**: 100%+（小标题应增加内容，不减少）
- **A_New_Heart 示例**: 32,018 → 32,165 字符（100.5%，仅增加 147 字符小标题）

---

## 4️⃣ 文件结构标准

### ✅ 每个讲道文件夹
```
sermons/{sermon_name}/
├── metadata.json      # 结构化元数据（标题、讲员、日期、经文等）
├── outline.md         # 美化后的讲道大纲
├── transcript.md      # 美化后的英文转录
└── translation.md     # 美化后的中文翻译
```

### ✅ 文件夹命名
- **规范化** - 使用 `file_normalizer.py` 转换
- **移除特殊字符** - `'` → `_`, `&` → `and`, `(` `)` → `_`
- **示例**: `Jesus' Model` → `Jesus'_Model_of_Spirituality`

---

## 5️⃣ 批量处理策略

### 阶段 1：安全段落合并（可批量）
```bash
# 批量迁移所有讲道到新结构（已完成）
python3 scripts/migrate_to_new_structure.py --batch

# 验证迁移结果
python3 scripts/verify_migration.py
```

**特点**：
- ✅ 安全、快速（~10 分钟处理 97 个讲道）
- ✅ 100% 内容保留（验证通过）
- ✅ 适合批量处理

### 阶段 2：小标题添加（选择性）
```bash
# 为重要讲道手动添加小标题
# 1. 阅读完整翻译
# 2. 识别讲道结构（引言、要点、结论等）
# 3. 添加描述性小标题
# 4. 验证内容完整性（100%+）
```

**特点**：
- ✅ 高质量、准确
- ⏱️ 耗时（每个讲道 ~10-15 分钟）
- 📝 适合重要讲道

### 阶段 3：翻译未完成的讲道（可批量）
```bash
# 翻译单个讲道
python3 scripts/translate_sermons.py --file "Sermon_Name"

# 批量翻译所有未完成的讲道
python3 scripts/translate_sermons.py --batch
```

**当前状态**：
- ✅ 已翻译: 34 个讲道
- 📋 需翻译: 62 个讲道

---

## 6️⃣ 工具清单

### ✅ 核心工具（已验证）

| 工具 | 功能 | 批量处理 | 内容保证 |
|------|------|----------|----------|
| `safe_paragraph_merger.py` | 安全段落聚合 | ✅ 是 | ✅ 100% |
| `migrate_to_new_structure.py` | 迁移到新结构 | ✅ 是 | ✅ 100% |
| `verify_migration.py` | 验证迁移结果 | ✅ 是 | - |
| `translate_sermons.py` | 翻译讲道内容 | ✅ 是 | ✅ 高质量 |
| `sermon_model.py` | 解析讲道数据 | - | ✅ 100% |
| `md_beautifier.py` | 基础格式美化 | ✅ 是 | ✅ 100% |

### ⚠️ 慎用工具（已验证问题）

| 工具 | 功能 | 问题 | 替代方案 |
|------|------|------|----------|
| `smart_beautifier.py` | LLM 智能美化 | ❌ 68% 内容丢失 | 手动添加小标题 |
| LLM 段落聚合 | 自动聚合段落 | ❌ 总结而非保留 | `safe_paragraph_merger.py` |

---

## 7️⃣ 质量检查清单

### ✅ 迁移前检查
- [ ] 备份原始文件（自动创建 `backup/`）
- [ ] 确认所有原始 MD 文件存在
- [ ] 运行 `--dry-run` 预览

### ✅ 迁移后检查
- [ ] 运行 `verify_migration.py` 验证
- [ ] 抽查 3-5 个讲道文件夹
- [ ] 检查内容长度变化（应在 ±2% 以内）
- [ ] 确认所有必需文件存在

### ✅ 小标题添加后检查
- [ ] 内容长度增加（而非减少）
- [ ] 小标题描述准确
- [ ] 小标题层级正确
- [ ] 保留 100% 原始内容

---

## 8️⃣ 成功案例：A_New_Heart

### 📊 处理结果
- **原始中文翻译**: 32,018 字符
- **添加小标题后**: 32,165 字符
- **内容完整性**: 100.5% ✅（仅增加 147 字符小标题）

### 📝 小标题结构
```markdown
### 引言
### 经文阅读：申命记 30:1-10
### 讲道框架
### 一、问题是什么：人类的终极困境
### 二、解决方案是什么：神所赐的新心
### 三、如何知道你有新心：三个重要迹象
    #### 迹象一：属灵意识的新质量——爱神为了神自己
    #### 迹象二：生命的实际改变——顺从从心发出
    #### 迹象三：属灵生命的成长——有机而非机械
### 四、如何接收新心：透过十字架的福音
### 结束祷告
```

### 🎯 质量特点
- ✅ 结构清晰（4 个主要部分）
- ✅ 层级合理（### 和 #### 两级）
- ✅ 描述准确（忠于讲道内容）
- ✅ 内容完整（100% 保留）

---

## 9️⃣ 常见问题

### Q1: 为什么不使用 LLM 自动添加小标题？
**A**: 已验证 LLM 会总结内容，导致 68% 内容丢失。手动添加虽慢，但保证 100% 内容完整性。

### Q2: 如何处理 62 个未翻译的讲道？
**A**: 使用现有的 `translate_sermons.py` 批量翻译，已验证高质量输出。

### Q3: 段落合并是否安全？
**A**: 是的。`safe_paragraph_merger.py` 已验证，99% 内容保留（±2% 允许误差仅因空格）。

### Q4: 是否需要为所有讲道添加小标题？
**A**: 可选。优先处理重要讲道。基础段落聚合已足够改善可读性。

---

## 🔟 下一步行动建议

### 优先级 P0（立即执行）
1. ✅ **已完成** - 批量迁移所有 97 个讲道
2. ✅ **已完成** - 验证迁移结果
3. 📋 **待执行** - 翻译 62 个未完成的讲道

### 优先级 P1（按需执行）
4. 📝 选择 10-20 个核心讲道手动添加小标题
5. 🔍 用户审查并反馈

### 优先级 P2（未来增强）
6. 🎙️ 实现 Apple Podcasts 下载器
7. 🗣️ 集成 Whisper 自动转录

---

**最后更新**: 2026-02-12
**验证状态**: ✅ 所有标准已在 A_New_Heart 和批量迁移中验证通过
